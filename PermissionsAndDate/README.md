# Разрешения, работа с датой и временем

В этом домашнем задании вы научитесь работать с разрешениями различных
уровней, добавите в приложение Runtime разрешения, поработаете с
местоположением пользователя, датой и временем в приложении.
Описание задания
1. Добавьте в манифест разрешение уровня normal — INTERNET.
2. Добавьте в манифест разрешение уровня dangerous —
ACCESS_FINE_LOCATION.
3. При открытии экрана приложения проверяйте, дано ли разрешение
ACCESS_FINE_LOCATION приложению.
Если доступа нет — отобразите заглушку с надписью, что для получения списка
локаций необходим доступ к разрешениям.
4. Если доступ есть — отобразите список местоположений пользователя.
Изначально показывайте пустой список и отобразите кнопку получения
местоположения.
5. По нажатию на кнопку «Разрешить» должно запрашиваться разрешение
ACCESS_FINE_LOCATION.
6. Если пользователь запретил доступ к локации — отобразите тост о
невозможности получить локацию без разрешения. Экран должен остаться в
состоянии из пункта 3.
7. Если пользователь разрешил доступ к местоположению — экран должен
перейти в состояние пункта 4.
8. Подключите Google play services для работы с локацией.
9. Подключите ThreeTenABP для работы с датой и временем, инициализируйте
библиотеку при запуске приложения.
10. При нажатии на кнопку «Получить локацию» запросите последнее
местоположение пользователя у Google play services.
11. Если последняя локация существует — добавьте её в dataset локаций.
Каждый элемент из dataset должен содержать следующую информацию:
- идентификатор локации — генерируйте случайный id при создании
элемента;
- метку времени, когда локация получена, — Instant (по умолчанию
получите текущую метку времени при создании элемента);
- данные по локации (lat, lng, accuracy, speed и другие по усмотрению);
- ссылку на изображение из интернета.
12. Отобразите элементы из dataset в списке:
- данные по локации выведите в текстовое поле элемента;
- отобразите изображение по ссылке в ImageView слева;
- отобразите дату и время получения локации в формате 20:35
09.10.2020, используйте часовой пояс по умолчанию.
13. По нажатию на элемент локации пользователь должен суметь вручную
установить дату и время её получения с помощью DatePickerDialog и
TimePickerDialog.
По умолчанию при открытии пикеров должны быть установлены дата и время
из выбранного элемента локации.
После выбора даты и времени метку времени необходимо обновить в списке,
для этого используйте обновление метки времени в dataset по идентификатору.
14. Используйте эмулятор с версией ОС < Android 6. Убедитесь, что приложение
работает корректно. Разрешение местоположения должно быть одобрено во
время установки и экран из пункта 3 не должен появляться.
15. * Добавьте отслеживание изменения местоположения пользователя с помощью
метода FusedLocationProviderClient.requestLocationUpdates. При изменении
местоположения автоматически добавляйте новое местоположение в список.
16. * Добавьте проверку присутствия на устройстве Google play services. В случае
отсутствия Google play services — отобразите диалог ошибки с невозможностью
его закрыть (параметр isCancelable). В случае, если Google play services
необходимо обновить, — отобразите диалог, позволяющий обновить их.
Рекомендации
Используйте репозиторий learning_materials / android_basic.
Скачайте изменения в репозитории на локальную машину.
Выполните домашнее задание в папке PermissionsAndDate.
Отправьте коммиты в удалённый репозиторий.
Загружайте изображение из интернета в элементе списка локаций с помощью
специальных библиотек, например Glide или Picasso.
Добавьте к RecyclerView paddingBottom + clipToPadding=false для того, чтобы
последний элемент списка локаций можно было всегда проскроллить выше кнопки
«Получить локацию».
Используйте DiffUtil для обновления списка местоположений.
Критерии оценки
1. Код оформлен в соответствии с правилами
https://kotlinlang.org/docs/reference/coding-conventions.html.
2. Соблюдён принцип инкапсуляции с помощью модификаторов доступа.
3. Классы являются не финальными (open, abstract) только при необходимости.
4. Текстовые строки не являются захардкоженными и используются из ресурсов.
5. При работе с локацией необходимо перед каждым действием проверять, что
разрешение было одобрено.
6. При отборе разрешения через настройки приложения пользовательский
интерфейс меняется соответствующим образом (переходит в состояние из
пункта 3).
7. Пользователю отображается информация, позволяющая понять, зачем
запрашивается разрешение.
8. Для работы с локацией используются Google play services.
9. При изменении часовых поясов в настройках и при перезапуске приложения
время получения локации должно быть в правильном часовом поясе.
10. Для работы с датой и временем необходимо использовать классы из JSR-310
backport (ThreeTen ABP).